# 测试流程设计文档

## 概述

本文档描述了Custom Rustdesk构建系统的测试流程设计，包括单元测试、集成测试和端到端测试的结构和执行方式。

## 测试目标

- 验证构建触发机制（手动和Issue触发）的正确性
- 确保队列管理系统能够正确处理并发构建请求
- 确认工作流状态监控和日志记录功能的可靠性
- 模拟真实场景下的高并发构建请求，测试系统的稳定性和性能

## 测试架构

### 测试类型

1. **单元测试**：针对单个功能或脚本的测试，验证其独立行为的正确性。
2. **集成测试**：验证多个组件或脚本之间的交互是否符合预期。
3. **端到端测试**：模拟真实用户场景，测试从构建触发到完成的全流程。

### 测试框架

- 使用bash脚本编写测试框架，提供统一的测试执行、结果记录和报告功能。
- 每个测试脚本都应该能够独立运行，同时也可以被主测试脚本调用。

## 测试流程

### 1. 环境准备

- 配置GitHub Token和必要的环境变量
- 确保测试环境与生产环境一致
- 初始化测试数据和状态

### 2. 测试执行

- **手动触发测试**：模拟用户手动触发构建流程，验证workflow是否正确触发和执行。
- **Issue触发测试**：通过创建Issue触发构建，验证Issue解析和构建参数传递的正确性。
- **队列状态测试**：检查Issue#1中存储的队列状态是否正确反映当前构建队列。
- **工作流状态测试**：验证GitHub Actions工作流的状态监控和日志记录功能。
- **高并发测试**：模拟多个构建请求，验证队列管理系统在高并发场景下的表现。

### 3. 结果验证

- 检查构建是否成功触发
- 验证队列状态是否正确更新
- 确认工作流状态和日志是否准确反映构建过程
- 记录测试结果并生成报告

### 4. 清理

- 清理测试过程中创建的临时数据和状态
- 关闭测试触发的Issues

## 测试脚本结构

- `run-tests.sh`：主测试脚本，负责运行所有测试流程
- `test_scripts/test-framework.sh`：测试框架，提供通用测试功能
- `test_scripts/test-utils.sh`：测试工具函数
- `test_scripts/test-manual-trigger.sh`：手动触发测试
- `test_scripts/test-issue-trigger.sh`：Issue触发测试
- `test_scripts/test-queue-status.sh`：队列状态测试
- `test_scripts/test-workflow-status.sh`：工作流状态测试
- `test_scripts/test-real-workflow-trigger.sh`：真实工作流触发测试

## 运行特定测试

您可以通过向 `run-tests.sh` 脚本传递参数来运行特定的测试。以下是可用的测试名称：

- `test-manual-trigger`：运行手动触发测试
- `test-issue-trigger`：运行问题触发测试
- `test-workflow-status`：运行工作流状态测试
- `test-queue-status`：运行队列状态测试
- `test-real-workflow-trigger`：运行真实工作流触发测试

示例命令：

```bash
./run-tests.sh test-manual-trigger
```

这将只运行手动触发测试，并显示相应的测试结果。

## 测试结果报告

- 每个测试用例都应该记录其结果（通过/失败）
- 测试完成后生成汇总报告，显示通过率和失败的测试用例详情
- 报告中应包含详细的日志信息，以便于问题诊断

## 测试注意事项

- 测试应该尽可能模拟真实场景
- 测试数据应该与生产数据结构一致
- 测试应该考虑各种边界情况和异常场景
- 测试应该能够重复运行，不会因为之前的测试状态而失败

## 持续集成

- 测试应该集成到GitHub Actions中，每次代码变更都自动运行
- 测试失败时应该通知相关开发人员
- 考虑设置每日定时运行完整测试流程，以捕获非代码变更导致的问题
